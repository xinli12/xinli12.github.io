<!-- Custom head content for elegant typography -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,500&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- MathJax Configuration for LaTeX support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true,
    packages: {'[+]': ['ams', 'newcommand', 'bbox', 'color', 'cancel']},
    tags: 'ams',
    macros: {
      RR: "{\\mathbb{R}}",
      CC: "{\\mathbb{C}}",
      ZZ: "{\\mathbb{Z}}",
      NN: "{\\mathbb{N}}",
      QQ: "{\\mathbb{Q}}",
      E: "{\\mathbb{E}}",
      Var: "{\\text{Var}}",
      Cov: "{\\text{Cov}}",
      given: "{\\,|\\,}"
    }
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  svg: {
    fontCache: 'global',
    displayAlign: 'center',
    scale: 1.05,
    linebreaks: { automatic: true }
  },
  chtml: {
    scale: 1.05,
    displayAlign: 'center'
  },
  startup: {
    ready: () => {
      MathJax.startup.defaultReady();
      // Ensure math respects theme colors
      const style = document.createElement('style');
      style.textContent = `
        mjx-container[jax="SVG"] svg {
          color: #2D1B20;
        }
        mjx-container[jax="CHTML"] mjx-math {
          color: #2D1B20;
        }
        .MathJax {
          color: #2D1B20 !important;
        }
      `;
      document.head.appendChild(style);
      
      // Re-render math after content is visible
      setTimeout(() => {
        MathJax.typesetPromise();
      }, 100);
    }
  }
};
</script>
<script async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<!-- Prism.js for enhanced syntax highlighting -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<!-- GitHub-style emoji support -->
<script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>

<style>
  /* Enhanced typography and base styles */
  * {
    font-variant-ligatures: common-ligatures;
    text-rendering: optimizeLegibility;
  }
  
  /* Global emoji size control - IMPORTANT: This must come first! */
  img.emoji,
  .emoji,
  img[src*="twemoji"],
  img[alt*="😀"], img[alt*="😃"], img[alt*="😄"], img[alt*="😁"], img[alt*="😆"], img[alt*="😅"], img[alt*="🤣"], img[alt*="😂"], img[alt*="🙂"], img[alt*="🙃"], img[alt*="😉"], img[alt*="😊"], img[alt*="😇"], img[alt*="🥰"], img[alt*="😍"], img[alt*="🤩"], img[alt*="😘"], img[alt*="😗"], img[alt*="☺"], img[alt*="😚"], img[alt*="😙"], img[alt*="🥲"], img[alt*="😋"], img[alt*="😛"], img[alt*="😜"], img[alt*="🤪"], img[alt*="😝"], img[alt*="🤑"], img[alt*="🤗"], img[alt*="🤭"], img[alt*="🤫"], img[alt*="🤔"], img[alt*="🤐"], img[alt*="🤨"], img[alt*="😐"], img[alt*="😑"], img[alt*="😶"], img[alt*="😏"], img[alt*="😒"], img[alt*="🙄"], img[alt*="😬"], img[alt*="🤥"], img[alt*="😔"], img[alt*="😪"], img[alt*="🤤"], img[alt*="😴"], img[alt*="😷"], img[alt*="🤒"], img[alt*="🤕"], img[alt*="🤢"], img[alt*="🤮"], img[alt*="🤧"], img[alt*="🥵"], img[alt*="🥶"], img[alt*="🥴"], img[alt*="😵"], img[alt*="🤯"], img[alt*="🤠"], img[alt*="🥳"], img[alt*="🥸"], img[alt*="😎"], img[alt*="🤓"], img[alt*="🧐"], img[alt*="😕"], img[alt*="😟"], img[alt*="🙁"], img[alt*="☹"], img[alt*="😮"], img[alt*="😯"], img[alt*="😲"], img[alt*="😳"], img[alt*="🥺"], img[alt*="😦"], img[alt*="😧"], img[alt*="😨"], img[alt*="😰"], img[alt*="😥"], img[alt*="😢"], img[alt*="😭"], img[alt*="😱"], img[alt*="😖"], img[alt*="😣"], img[alt*="😞"], img[alt*="😓"], img[alt*="😩"], img[alt*="😫"], img[alt*="🥱"], img[alt*="😤"], img[alt*="😡"], img[alt*="😠"], img[alt*="🤬"], img[alt*="😈"], img[alt*="👿"], img[alt*="💀"], img[alt*="☠"], img[alt*="💩"], img[alt*="🤡"], img[alt*="👹"], img[alt*="👺"], img[alt*="👻"], img[alt*="👽"], img[alt*="👾"], img[alt*="🤖"], img[alt*="🎃"], img[alt*="😺"], img[alt*="😸"], img[alt*="😹"], img[alt*="😻"], img[alt*="😼"], img[alt*="😽"], img[alt*="🙀"], img[alt*="😿"], img[alt*="😾"],
  img[alt*="👋"], img[alt*="🤚"], img[alt*="🖐"], img[alt*="✋"], img[alt*="🖖"], img[alt*="👌"], img[alt*="🤌"], img[alt*="🤏"], img[alt*="✌"], img[alt*="🤞"], img[alt*="🤟"], img[alt*="🤘"], img[alt*="🤙"], img[alt*="👈"], img[alt*="👉"], img[alt*="👆"], img[alt*="🖕"], img[alt*="👇"], img[alt*="☝"], img[alt*="👍"], img[alt*="👎"], img[alt*="👊"], img[alt*="✊"], img[alt*="🤛"], img[alt*="🤜"], img[alt*="👏"], img[alt*="🙌"], img[alt*="👐"], img[alt*="🤲"], img[alt*="🤝"], img[alt*="🙏"],
  img[alt*="❤"], img[alt*="🧡"], img[alt*="💛"], img[alt*="💚"], img[alt*="💙"], img[alt*="💜"], img[alt*="🖤"], img[alt*="🤍"], img[alt*="🤎"], img[alt*="💔"], img[alt*="❣"], img[alt*="💕"], img[alt*="💞"], img[alt*="💓"], img[alt*="💗"], img[alt*="💖"], img[alt*="💘"], img[alt*="💝"], img[alt*="💟"],
  img[alt*="✨"], img[alt*="💫"], img[alt*="⭐"], img[alt*="🌟"], img[alt*="💥"], img[alt*="💦"], img[alt*="💨"], img[alt*="🔥"], img[alt*="❄"], img[alt*="☀"], img[alt*="🌤"], img[alt*="⛅"], img[alt*="🌦"], img[alt*="🌧"], img[alt*="⛈"], img[alt*="🌩"], img[alt*="🌨"], img[alt*="☁"], img[alt*="🌪"], img[alt*="🌬"], img[alt*="🌈"], img[alt*="☂"], img[alt*="☔"], img[alt*="⛱"], img[alt*="⚡"], img[alt*="❄"], img[alt*="☃"], img[alt*="⛄"], img[alt*="🔴"], img[alt*="🟠"], img[alt*="🟡"], img[alt*="🟢"], img[alt*="🔵"], img[alt*="🟣"], img[alt*="🟤"], img[alt*="⚫"], img[alt*="⚪"], img[alt*="🟥"], img[alt*="🟧"], img[alt*="🟨"], img[alt*="🟩"], img[alt*="🟦"], img[alt*="🟪"], img[alt*="🟫"], img[alt*="⬛"], img[alt*="⬜"], img[alt*="◼"], img[alt*="◻"], img[alt*="◾"], img[alt*="◽"], img[alt*="▪"], img[alt*="▫"],
  img[alt*="🎯"], img[alt*="🎮"], img[alt*="🎲"], img[alt*="🎸"], img[alt*="🎺"], img[alt*="🎻"], img[alt*="🥁"], img[alt*="🎹"], img[alt*="🎤"], img[alt*="🎧"], img[alt*="📻"], img[alt*="🎬"], img[alt*="🎭"], img[alt*="🎨"], img[alt*="🎪"], img[alt*="🎉"], img[alt*="🎊"], img[alt*="🎁"], img[alt*="🎀"], img[alt*="🎈"], img[alt*="🎂"], img[alt*="🍰"], img[alt*="🧁"], img[alt*="🥧"], img[alt*="🍫"], img[alt*="🍬"], img[alt*="🍭"], img[alt*="🍮"], img[alt*="🍯"],
  img[alt*="🌍"], img[alt*="🌎"], img[alt*="🌏"], img[alt*="🌐"], img[alt*="🗺"], img[alt*="🗾"], img[alt*="🧭"], img[alt*="🏔"], img[alt*="⛰"], img[alt*="🌋"], img[alt*="🗻"], img[alt*="🏕"], img[alt*="🏖"], img[alt*="🏜"], img[alt*="🏝"], img[alt*="🏞"], img[alt*="🏟"], img[alt*="🏛"], img[alt*="🏗"], img[alt*="🧱"], img[alt*="🪨"], img[alt*="🪵"], img[alt*="🛖"], img[alt*="🏘"], img[alt*="🏚"], img[alt*="🏠"], img[alt*="🏡"], img[alt*="🏢"], img[alt*="🏣"], img[alt*="🏤"], img[alt*="🏥"], img[alt*="🏦"], img[alt*="🏨"], img[alt*="🏩"], img[alt*="🏪"], img[alt*="🏫"], img[alt*="🏬"], img[alt*="🏭"], img[alt*="🏯"], img[alt*="🏰"], img[alt*="💒"], img[alt*="🗼"], img[alt*="🗽"], img[alt*="⛪"], img[alt*="🕌"], img[alt*="🛕"], img[alt*="🕍"], img[alt*="⛩"], img[alt*="🕋"], img[alt*="⛲"], img[alt*="⛺"], img[alt*="🌁"], img[alt*="🌃"], img[alt*="🏙"], img[alt*="🌄"], img[alt*="🌅"], img[alt*="🌆"], img[alt*="🌇"], img[alt*="🌉"], img[alt*="♨"], img[alt*="🎠"], img[alt*="🎡"], img[alt*="🎢"], img[alt*="💈"], img[alt*="🎪"],
  img[alt*="🚗"], img[alt*="🚕"], img[alt*="🚙"], img[alt*="🚌"], img[alt*="🚎"], img[alt*="🏎"], img[alt*="🚓"], img[alt*="🚑"], img[alt*="🚒"], img[alt*="🚐"], img[alt*="🚚"], img[alt*="🚛"], img[alt*="🚜"], img[alt*="🦯"], img[alt*="🦽"], img[alt*="🦼"], img[alt*="🛴"], img[alt*="🚲"], img[alt*="🛵"], img[alt*="🏍"], img[alt*="🛺"], img[alt*="🚨"], img[alt*="🚔"], img[alt*="🚍"], img[alt*="🚘"], img[alt*="🚖"], img[alt*="🚡"], img[alt*="🚠"], img[alt*="🚟"], img[alt*="🚃"], img[alt*="🚋"], img[alt*="🚞"], img[alt*="🚝"], img[alt*="🚄"], img[alt*="🚅"], img[alt*="🚈"], img[alt*="🚂"], img[alt*="🚆"], img[alt*="🚇"], img[alt*="🚊"], img[alt*="🚉"], img[alt*="✈"], img[alt*="🛫"], img[alt*="🛬"], img[alt*="🛩"], img[alt*="💺"], img[alt*="🛰"], img[alt*="🚀"], img[alt*="🛸"], img[alt*="🚁"], img[alt*="🛶"], img[alt*="⛵"], img[alt*="🚤"], img[alt*="🛥"], img[alt*="🛳"], img[alt*="⛴"], img[alt*="🚢"], img[alt*="⚓"], img[alt*="⛽"], img[alt*="🚧"], img[alt*="🚦"], img[alt*="🚥"], img[alt*="🚏"], img[alt*="🗺"], img[alt*="🗿"], img[alt*="🗽"], img[alt*="🗼"], img[alt*="🏰"], img[alt*="🏯"], img[alt*="🏟"], img[alt*="🎡"], img[alt*="🎢"], img[alt*="🎠"],
  img[alt*="💎"], img[alt*="📱"], img[alt*="📲"], img[alt*="💻"], img[alt*="⌨"], img[alt*="🖥"], img[alt*="🖨"], img[alt*="🖱"], img[alt*="🖲"], img[alt*="🕹"], img[alt*="🗜"], img[alt*="💽"], img[alt*="💾"], img[alt*="💿"], img[alt*="📀"], img[alt*="📼"], img[alt*="📷"], img[alt*="📸"], img[alt*="📹"], img[alt*="🎥"], img[alt*="📽"], img[alt*="🎞"], img[alt*="📞"], img[alt*="☎"], img[alt*="📟"], img[alt*="📠"], img[alt*="📺"], img[alt*="📻"], img[alt*="🎙"], img[alt*="🎚"], img[alt*="🎛"], img[alt*="🧭"], img[alt*="⏱"], img[alt*="⏲"], img[alt*="⏰"], img[alt*="🕐"], img[alt*="🕑"], img[alt*="🕒"], img[alt*="🕓"], img[alt*="🕔"], img[alt*="🕕"], img[alt*="🕖"], img[alt*="🕗"], img[alt*="🕘"], img[alt*="🕙"], img[alt*="🕚"], img[alt*="🕛"], img[alt*="🕜"], img[alt*="🕝"], img[alt*="🕞"], img[alt*="🕟"], img[alt*="🕠"], img[alt*="🕡"], img[alt*="🕢"], img[alt*="🕣"], img[alt*="🕤"], img[alt*="🕥"], img[alt*="🕦"], img[alt*="🕧"], img[alt*="🌑"], img[alt*="🌒"], img[alt*="🌓"], img[alt*="🌔"], img[alt*="🌕"], img[alt*="🌖"], img[alt*="🌗"], img[alt*="🌘"], img[alt*="🌙"], img[alt*="🌚"], img[alt*="🌛"], img[alt*="🌜"], img[alt*="🌡"], img[alt*="☀"], img[alt*="🔆"], img[alt*="🔅"], img[alt*="💡"], img[alt*="🔦"], img[alt*="🕯"], img[alt*="🪔"], img[alt*="🧯"], img[alt*="🛢"], img[alt*="💸"], img[alt*="💵"], img[alt*="💴"], img[alt*="💶"], img[alt*="💷"], img[alt*="💰"], img[alt*="💳"], img[alt*="🪙"], img[alt*="💎"], img[alt*="⚖"], img[alt*="🧰"], img[alt*="🔧"], img[alt*="🔨"], img[alt*="⚒"], img[alt*="🛠"], img[alt*="⛏"], img[alt*="🪓"], img[alt*="🪚"], img[alt*="🔩"], img[alt*="⚙"], img[alt*="🧱"], img[alt*="⛓"], img[alt*="🧲"], img[alt*="🔫"], img[alt*="💣"], img[alt*="🧨"], img[alt*="🪃"], img[alt*="🏹"], img[alt*="🛡"], img[alt*="🪚"], img[alt*="🔪"], img[alt*="⚔"], img[alt*="🪆"],
  img[alt*="📚"], img[alt*="📖"], img[alt*="📒"], img[alt*="📕"], img[alt*="📗"], img[alt*="📘"], img[alt*="📙"], img[alt*="📓"], img[alt*="📔"], img[alt*="📑"], img[alt*="📃"], img[alt*="📄"], img[alt*="📰"], img[alt*="🗞"], img[alt*="📊"], img[alt*="📈"], img[alt*="📉"], img[alt*="🗒"], img[alt*="🗓"], img[alt*="📆"], img[alt*="📅"], img[alt*="🗑"], img[alt*="📇"], img[alt*="🗃"], img[alt*="🗳"], img[alt*="🗄"], img[alt*="📋"], img[alt*="📌"], img[alt*="📍"], img[alt*="📎"], img[alt*="🖇"], img[alt*="📏"], img[alt*="📐"], img[alt*="✂"], img[alt*="🗝"], img[alt*="🔐"], img[alt*="🔒"], img[alt*="🔓"], img[alt*="🔏"], img[alt*="🔑"], img[alt*="🗝"], img[alt*="🔨"], img[alt*="🪓"], img[alt*="⛏"], img[alt*="⚒"], img[alt*="🛠"], img[alt*="🗡"], img[alt*="⚔"], img[alt*="🔫"], img[alt*="🪃"], img[alt*="🏹"], img[alt*="🛡"], img[alt*="🪚"], img[alt*="🔧"], img[alt*="🪛"], img[alt*="🔩"], img[alt*="⚙"], img[alt*="🗜"], img[alt*="⚖"], img[alt*="🦯"], img[alt*="🔗"], img[alt*="⛓"], img[alt*="🪝"], img[alt*="🧰"], img[alt*="🧲"], img[alt*="🪜"], img[alt*="🧪"], img[alt*="🧫"], img[alt*="🧬"], img[alt*="🔬"], img[alt*="🔭"], img[alt*="📡"],
  svg.emoji,
  [data-twemoji] {
    width: 1.2em !important;
    height: 1.2em !important;
    max-width: 1.2em !important;
    max-height: 1.2em !important;
    display: inline-block !important;
    vertical-align: -0.2em !important;
    margin: 0 0.05em 0 0.1em !important;
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
    border-radius: 0 !important;
    transform: none !important;
    transition: none !important;
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
    font-feature-settings: "liga", "kern", "calt";
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background: #FEFCFD;
    line-height: 1.6;
    color: #2D1B20;
  }
  
  /* Elegant serif headings */
  h1, h2, h3, h4, h5, h6, .site-title {
    font-family: 'Crimson Pro', Georgia, serif !important;
    color: #8B1538;
    letter-spacing: -0.02em;
    font-weight: 600;
    line-height: 1.3;
  }
  
  h1 {
    font-weight: 700;
    letter-spacing: -0.03em;
  }
  
  h2 {
    font-weight: 600;
    letter-spacing: -0.02em;
  }
  
  h3, h4 {
    font-weight: 600;
    letter-spacing: -0.01em;
  }
  
  .site-title {
    font-weight: 700 !important;
    color: #8B1538 !important;
    letter-spacing: -0.03em;
  }
  
  /* Clean sans-serif body text */
  p, li, span, div {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
    letter-spacing: 0.01em;
  }
  
  /* Refined lead text */
  .lead {
    font-family: 'Crimson Pro', Georgia, serif !important;
    font-style: italic;
    font-weight: 400;
    letter-spacing: -0.01em;
  }
  
  /* Enhanced Code Block Styling */
  code, pre, .highlight {
    font-family: 'Fira Code', 'JetBrains Mono', 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace !important;
    font-feature-settings: "liga", "calt", "ss01", "ss02", "ss03", "ss04", "ss05";
    font-variant-ligatures: contextual;
  }
  
  /* Inline code styling */
  code:not(pre code) {
    background: linear-gradient(135deg, #F8E8EC, #FDF5F7);
    color: #8B1538;
    padding: 0.2em 0.5em;
    border-radius: 4px;
    font-size: 0.875em;
    font-weight: 500;
    border: 1px solid rgba(139, 21, 56, 0.1);
    box-shadow: 0 1px 3px rgba(139, 21, 56, 0.08);
    transition: all 0.15s ease;
    letter-spacing: 0.01em;
  }
  
  code:not(pre code):hover {
    background: linear-gradient(135deg, #F3D5DC, #F8E8EC);
    border-color: rgba(139, 21, 56, 0.2);
    box-shadow: 0 2px 6px rgba(139, 21, 56, 0.12);
  }
  

  
  /* Keep OUTPUT cells with their original styling (including red warnings) */
  .jp-OutputArea pre,
  .jp-OutputArea-output pre,
  .output_area pre,
  .output_subarea pre,
  .output_text pre,
  .output_stream pre,
  .output_stdout pre,
  .output_stderr pre,
  .output_error pre,
  .jp-RenderedText pre,
  .jp-OutputArea-child pre,
  .notebook .output pre,
  .nboutput pre,
  .post-content .jp-OutputArea pre,
  .post-content .output_area pre,
  .post-content .output_subarea pre {
    /* No custom styling - preserve original Jupyter output appearance */
    background: transparent !important;
    border: none !important;
    border-radius: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    box-shadow: none !important;
    position: static !important;
    transition: none !important;
    line-height: inherit !important;
    font-size: inherit !important;
  }
  
  /* Keep ALL Jupyter notebook code elements unstyled (both input and output) */
  .jp-InputArea code,
  .jp-InputArea pre,
  .input_area code,
  .input_area pre,
  .jp-OutputArea code,
  .jp-OutputArea-output code,
  .output_area code,
  .output_subarea code,
  .output_text code,
  .output_stream code,
  .output_stdout code,
  .output_stderr code,
  .output_error code,
  .post-content .jp-InputArea code,
  .post-content .input_area code,
  .post-content .jp-OutputArea code,
  .post-content .output_area code,
  .notebook code,
  .jupyter code,
  .nbinput code,
  .nboutput code,
  .CodeMirror code,
  .cm-s-jupyter code,
  .highlight-ipynb code {
    background: transparent !important;
    color: inherit !important;
    padding: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    font-size: inherit !important;
    font-weight: inherit !important;
  }
  
  /* Ensure Jupyter notebook input areas (code cells) are not styled */
  .jp-InputArea pre,
  .input_area pre,
  .notebook .input pre,
  .jupyter .input pre,
  .nbinput pre,
  .CodeMirror pre,
  .cm-s-jupyter pre,
  .highlight-ipynb pre,
  .post-content .jp-InputArea pre,
  .post-content .input_area pre,
  .post-content .notebook .input pre,
  .post-content .jupyter .input pre,
  .post-content .nbinput pre {
    background: transparent !important;
    border: none !important;
    border-radius: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    box-shadow: none !important;
    position: static !important;
    transition: none !important;
    line-height: inherit !important;
    font-size: inherit !important;
  }
  
  /* Preserve error output styling (red backgrounds, etc.) */
  .jp-OutputArea-output.jp-mod-system-error,
  .output_stderr,
  .output_error,
  .jp-RenderedText[data-mime-type*="error"],
  [data-mime-type="application/vnd.jupyter.stderr"],
  .ansi-red-bg,
  .ansi-red-intense-bg {
    /* Preserve original styling */
  }
  
  /* FINAL OVERRIDE: Completely reset any custom styling for ALL Jupyter notebook content */
  .jp-Notebook,
  .jp-Notebook *,
  .jupyter-notebook,
  .jupyter-notebook *,
  article[data-mime-type*="jupyter"],
  article[data-mime-type*="jupyter"] *,
  .post-content .jp-Notebook,
  .post-content .jp-Notebook *,
  .post-content .jupyter-notebook,
  .post-content .jupyter-notebook *,
  .content-wrapper .jp-Notebook,
  .content-wrapper .jp-Notebook *,
  .content-wrapper .jupyter-notebook,
  .content-wrapper .jupyter-notebook * {
    /* Reset ALL custom code styling for Jupyter content */
  }
  
  .jp-Notebook pre,
  .jp-Notebook code,
  .jupyter-notebook pre,
  .jupyter-notebook code,
  article[data-mime-type*="jupyter"] pre,
  article[data-mime-type*="jupyter"] code,
  .post-content .jp-Notebook pre,
  .post-content .jp-Notebook code,
  .post-content .jupyter-notebook pre,
  .post-content .jupyter-notebook code,
  .content-wrapper .jp-Notebook pre,
  .content-wrapper .jp-Notebook code,
  .content-wrapper .jupyter-notebook pre,
  .content-wrapper .jupyter-notebook code {
    background: initial !important;
    border: initial !important;
    border-radius: initial !important;
    padding: initial !important;
    margin: initial !important;
    box-shadow: initial !important;
    position: initial !important;
    transition: initial !important;
    line-height: initial !important;
    font-size: initial !important;
    color: initial !important;
    font-weight: initial !important;
    transform: initial !important;
    filter: initial !important;
  }
  

  
  /* Regular Jekyll post code blocks (non-Jupyter) */
  /* Exclude ALL Jupyter notebook elements from custom styling */
  pre:not(.jp-InputArea pre):not(.input_area pre):not(.jp-OutputArea pre):not(.output_area pre):not(.jupyter pre):not(.notebook pre):not(.nbinput pre):not(.nboutput pre):not(.highlight-ipynb pre):not(.CodeMirror pre):not(.cm-s-jupyter pre):not(.highlight .codehilite pre):not(.highlight .highlight pre) {
    background: linear-gradient(135deg, #FEFCFD 0%, #FDF5F7 100%) !important;
    border: 1px solid #E8D4D8 !important;
    border-left: 4px solid #8B1538 !important;
    border-radius: 8px !important;
    padding: 1.5rem 1.75rem !important;
    margin: 2rem 0 !important;
    overflow-x: auto !important;
    box-shadow: 0 4px 12px rgba(139, 21, 56, 0.08), 
                0 1px 3px rgba(139, 21, 56, 0.12) !important;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    line-height: 1.5;
    font-size: 0.9rem;
  }
  
  pre:not(.jp-InputArea pre):not(.input_area pre):not(.jp-OutputArea pre):not(.output_area pre):not(.jupyter pre):not(.notebook pre):not(.nbinput pre):not(.nboutput pre):not(.highlight-ipynb pre):not(.CodeMirror pre):not(.cm-s-jupyter pre):not(.highlight .codehilite pre):not(.highlight .highlight pre):hover {
    border-left-color: #B91C4D !important;
    box-shadow: 0 6px 20px rgba(139, 21, 56, 0.12), 
                0 2px 6px rgba(139, 21, 56, 0.16) !important;
  }
  

  
  /* Code block styling fallback - but NOT for Jupyter notebooks */
  .post-content pre:not(.jp-InputArea pre):not(.input_area pre):not(.jp-OutputArea pre):not(.output_area pre):not(.jupyter pre):not(.notebook pre):not(.nbinput pre):not(.nboutput pre):not(.highlight-ipynb pre):not(.CodeMirror pre):not(.cm-s-jupyter pre),
  .content-wrapper pre:not(.jp-InputArea pre):not(.input_area pre):not(.jp-OutputArea pre):not(.output_area pre):not(.jupyter pre):not(.notebook pre):not(.nbinput pre):not(.nboutput pre):not(.highlight-ipynb pre):not(.CodeMirror pre):not(.cm-s-jupyter pre) {
    background: linear-gradient(135deg, #FEFCFD 0%, #FDF5F7 100%) !important;
    border: 1px solid #E8D4D8 !important;
    border-left: 4px solid #8B1538 !important;
    border-radius: 8px !important;
    padding: 1.5rem 1.75rem !important;
    margin: 2rem 0 !important;
    overflow-x: auto !important;
    box-shadow: 0 4px 12px rgba(139, 21, 56, 0.08), 
                0 1px 3px rgba(139, 21, 56, 0.12) !important;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    line-height: 1.5;
    font-size: 0.9rem;
  }
  
  .post-content pre:not(.jp-InputArea pre):not(.input_area pre):not(.jp-OutputArea pre):not(.output_area pre):not(.jupyter pre):not(.notebook pre):not(.nbinput pre):not(.nboutput pre):not(.highlight-ipynb pre):not(.CodeMirror pre):not(.cm-s-jupyter pre):hover,
  .content-wrapper pre:not(.jp-InputArea pre):not(.input_area pre):not(.jp-OutputArea pre):not(.output_area pre):not(.jupyter pre):not(.notebook pre):not(.nbinput pre):not(.nboutput pre):not(.highlight-ipynb pre):not(.CodeMirror pre):not(.cm-s-jupyter pre):hover {
    border-left-color: #B91C4D !important;
    box-shadow: 0 6px 20px rgba(139, 21, 56, 0.12), 
                0 2px 6px rgba(139, 21, 56, 0.16) !important;
  }
  
  /* Code in pre blocks */
  pre code {
    background: none !important;
    color: #2D1B20 !important;
    padding: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    font-size: inherit !important;
    font-weight: 400 !important;
    display: block;
    white-space: pre;
    word-wrap: normal;
    word-break: normal;
    tab-size: 2;
  }
  
  /* Copy button for code blocks */
  pre[data-language]::before {
    content: attr(data-language);
    position: absolute;
    top: 0.75rem;
    right: 3.5rem;
    font-size: 0.75rem;
    font-weight: 500;
    color: #8B7B7E;
    background: rgba(248, 232, 236, 0.8);
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: 1px solid rgba(139, 21, 56, 0.1);
    z-index: 5;
  }
  
  /* Syntax highlighting customization */
  .token.comment,
  .token.prolog,
  .token.doctype,
  .token.cdata {
    color: #8B7B7E;
    font-style: italic;
  }
  
  .token.punctuation {
    color: #5A4A4E;
  }
  
  .token.property,
  .token.tag,
  .token.boolean,
  .token.number,
  .token.constant,
  .token.symbol,
  .token.deleted {
    color: #A61E3C;
  }
  
  .token.selector,
  .token.attr-name,
  .token.string,
  .token.char,
  .token.builtin,
  .token.inserted {
    color: #8B1538;
  }
  
  .token.operator,
  .token.entity,
  .token.url,
  .language-css .token.string,
  .style .token.string {
    color: #B91C4D;
  }
  
  .token.atrule,
  .token.attr-value,
  .token.keyword {
    color: #5A4A4E;
    font-weight: 500;
  }
  
  .token.function,
  .token.class-name {
    color: #2D1B20;
    font-weight: 500;
  }
  
  .token.regex,
  .token.important,
  .token.variable {
    color: #A61E3C;
  }
  
  /* Math styling integration */
  mjx-container[jax="SVG"] {
    margin: 1em 0;
    padding: 0.5em 0;
  }
  
  mjx-container[jax="SVG"][display="true"] {
    background: linear-gradient(135deg, #FEFCFD 0%, #FDF5F7 100%);
    border: 1px solid #E8D4D8;
    border-left: 4px solid #8B1538;
    border-radius: 8px;
    padding: 1.5rem;
    margin: 2rem 0;
    box-shadow: 0 2px 8px rgba(139, 21, 56, 0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  mjx-container[jax="SVG"][display="true"]:hover {
    border-left-color: #B91C4D;
    box-shadow: 0 4px 12px rgba(139, 21, 56, 0.12);
  }
  
  /* Inline math */
  mjx-container[jax="SVG"][display="false"] {
    background: rgba(248, 232, 236, 0.3);
    padding: 0.1em 0.3em;
    border-radius: 3px;
    margin: 0 0.1em;
  }
  
  /* Math numbering and references */
  .mjx-tag {
    color: #8B1538 !important;
    font-weight: 500;
  }
  
  /* Scrollbar styling for code blocks */
  pre::-webkit-scrollbar {
    height: 8px;
    width: 8px;
  }
  
  pre::-webkit-scrollbar-track {
    background: rgba(248, 232, 236, 0.3);
    border-radius: 4px;
  }
  
  pre::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #8B1538, #B91C4D);
    border-radius: 4px;
  }
  
  pre::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(90deg, #B91C4D, #8B1538);
  }
  
  /* Refined link styling with smooth animations */
  a {
    color: #8B1538;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration-thickness: 1px;
    text-underline-offset: 3px;
  }
  
  a:hover {
    color: #B91C4D;
    text-decoration-thickness: 2px;
    transform: translateY(-0.5px);
  }
  
  /* Clean navigation with enhanced animations */
  .site-nav .page-link {
    font-family: 'Inter', sans-serif;
    font-weight: 500;
    letter-spacing: 0.01em;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Enhanced Button System */
  .elegant-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-family: 'Inter', sans-serif;
    font-weight: 500;
    font-size: 0.9rem;
    letter-spacing: 0.01em;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    text-underline-offset: 0 !important;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #8B1538 0%, #A61E3C 50%, #B91C4D 100%);
    color: white !important;
    box-shadow: 0 3px 12px rgba(139, 21, 56, 0.15);
  }
  
  .elegant-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
    z-index: 0;
  }
  
  .elegant-button {
    position: relative;
    z-index: 1;
  }
  
  .elegant-button:hover {
    color: white !important;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    transform: translateY(-2px);
    box-shadow: 0 6px 24px rgba(139, 21, 56, 0.25);
  }
  
  .elegant-button:hover::before {
    left: 100%;
  }
  
  .elegant-button:active {
    transform: translateY(0);
  }
  
  /* Button variants */
  .elegant-button-secondary {
    background: linear-gradient(135deg, #F8E8EC 0%, #FDF5F7 100%);
    color: #8B1538 !important;
    border: 2px solid #E8D4D8;
    box-shadow: 0 2px 8px rgba(139, 21, 56, 0.08);
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    text-underline-offset: 0 !important;
  }
  
  .elegant-button-secondary:hover {
    color: #8B1538 !important;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    background: linear-gradient(135deg, #F3D5DC 0%, #F8E8EC 100%);
    border-color: #8B1538;
    box-shadow: 0 4px 16px rgba(139, 21, 56, 0.15);
  }
  
  .elegant-button-small {
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    text-underline-offset: 0 !important;
  }
  
  .elegant-button-icon {
    min-width: 2.5rem;
    min-height: 2.5rem;
    border-radius: 50%;
    padding: 0;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    text-underline-offset: 0 !important;
  }
  
  /* Enhanced Tags */
  .tag {
    display: inline-flex;
    align-items: center;
    padding: 0.35rem 0.75rem;
    font-family: 'Inter', sans-serif;
    font-size: 0.8rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    background: linear-gradient(135deg, #F8E8EC, #FDF5F7);
    color: #8B1538;
    border: 1px solid #E8D4D8;
    border-radius: 20px;
    text-decoration: none;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 1px 3px rgba(139, 21, 56, 0.05);
  }
  
  .tag:hover {
    background: linear-gradient(135deg, #8B1538, #B91C4D);
    color: white;
    border-color: #8B1538;
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(139, 21, 56, 0.2);
  }
  
  /* Enhanced Cards */
  .hover-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(139, 21, 56, 0.05);
  }
  
  .hover-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(139, 21, 56, 0.12);
  }
  
  /* Social Share Buttons */
  .social-share-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    text-underline-offset: 0 !important;
    color: white;
    font-size: 1rem;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    cursor: pointer;
  }
  
  .social-share-btn:hover {
    color: white;
    text-decoration: none !important;
    text-decoration-thickness: 0 !important;
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
  
  /* Custom Selection Colors */
  ::selection {
    background: rgba(139, 21, 56, 0.2);
    color: #2D1B20;
  }
  
  ::-moz-selection {
    background: rgba(139, 21, 56, 0.2);
    color: #2D1B20;
  }
  
  /* Enhanced Focus States */
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible,
  a:focus-visible {
    outline: 2px solid #8B1538;
    outline-offset: 2px;
    border-radius: 4px;
  }
  
  /* Jupyter Notebook Override Protection - CRITICAL */
  /* Protect site header and navigation from notebook CSS interference */
  .site-header,
  .site-header *,
  .site-nav,
  .site-nav *,
  .site-title,
  .page-link,
  .trigger,
  .menu-icon {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
  }
  
  /* Force site title styling regardless of notebook CSS */
  .site-header .site-title,
  body .site-header .site-title,
  html .site-header .site-title {
    font-family: 'Manrope', sans-serif !important;
    font-weight: 700 !important;
    font-size: 1.5rem !important;
    color: #8B1538 !important;
    letter-spacing: -0.03em !important;
    line-height: 1.2 !important;
  }
  
  /* Force navigation link styling regardless of notebook CSS */
  .site-nav .page-link,
  body .site-nav .page-link,
  html .site-nav .page-link {
    font-family: 'Inter', sans-serif !important;
    font-weight: 500 !important;
    font-size: 1rem !important;
    color: #5A4A4E !important;
    letter-spacing: 0.01em !important;
    line-height: 1.5 !important;
    text-decoration: none !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  }
  
  /* Force navigation hover states */
  .site-nav .page-link:hover,
  body .site-nav .page-link:hover,
  html .site-nav .page-link:hover {
    color: #8B1538 !important;
    transform: translateY(-1px) !important;
  }
  
  /* Force navigation current page styling */
  .site-nav .page-link[aria-current="page"],
  body .site-nav .page-link[aria-current="page"],
  html .site-nav .page-link[aria-current="page"] {
    color: #8B1538 !important;
    font-weight: 600 !important;
  }
  
  /* Force site header wrapper styling */
  .site-header .wrapper,
  body .site-header .wrapper,
  html .site-header .wrapper {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 0.5rem 1.5rem !important;
  }
  
  /* Force trigger (navigation container) styling */
  .site-nav .trigger,
  body .site-nav .trigger,
  html .site-nav .trigger {
    display: flex !important;
    gap: 1.5rem !important;
    align-items: center !important;
  }
  
  /* Prevent notebook CSS from affecting header positioning */
  .site-header,
  body .site-header,
  html .site-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 100 !important;
    background: rgba(254, 252, 253, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    border-bottom: 1px solid #E8D4D8 !important;
    box-shadow: 0 1px 3px rgba(139, 21, 56, 0.1) !important;
  }
  
  /* Mobile menu icon protection */
  .menu-icon,
  body .menu-icon,
  html .menu-icon {
    width: 36px !important;
    height: 36px !important;
    cursor: pointer !important;
  }
  
  .menu-icon span,
  body .menu-icon span,
  html .menu-icon span {
    display: block !important;
    width: 24px !important;
    height: 2px !important;
    background: #8B1538 !important;
    margin: 3px 0 !important;
    transition: all 0.3s ease !important;
  }
  
  /* Responsive Typography */
  @media (max-width: 768px) {
    /* Mobile navigation protection from notebook CSS */
    .site-header .wrapper,
    body .site-header .wrapper,
    html .site-header .wrapper {
      padding: 0.4rem 1rem !important;
    }
    
    .site-title,
    body .site-title,
    html .site-title {
      font-size: 1.25rem !important;
    }
    
    .menu-icon,
    body .menu-icon,
    html .menu-icon {
      display: flex !important;
      flex-direction: column !important;
      justify-content: center !important;
      align-items: center !important;
    }
    
    .trigger:not(.mobile-menu-open),
    body .trigger:not(.mobile-menu-open),
    html .trigger:not(.mobile-menu-open) {
      display: none !important;
    }
    
    .trigger.mobile-menu-open,
    body .trigger.mobile-menu-open,
    html .trigger.mobile-menu-open {
      display: flex !important;
      position: absolute !important;
      top: 100% !important;
      right: 0 !important;
      flex-direction: column !important;
      gap: 0.5rem !important;
      background: rgba(254, 252, 253, 0.98) !important;
      padding: 1rem !important;
      border-radius: 4px !important;
      box-shadow: 0 4px 12px rgba(139, 21, 56, 0.2) !important;
      backdrop-filter: blur(10px) !important;
      border: 1px solid #E8D4D8 !important;
      min-width: 200px !important;
      z-index: 1000 !important;
    }
    
    .trigger.mobile-menu-open .page-link,
    body .trigger.mobile-menu-open .page-link,
    html .trigger.mobile-menu-open .page-link {
      margin: 0.25rem 0 !important;
      padding: 0.75rem 1rem !important;
      border-radius: 4px !important;
      display: block !important;
      text-align: center !important;
    }
    
    body {
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    h1 {
      font-size: 1.75rem;
    }
    
    h2 {
      font-size: 1.5rem;
    }
    
    h3 {
      font-size: 1.25rem;
    }
    
    .lead {
      font-size: 1rem;
    }
    
    pre {
      padding: 1rem 1.25rem !important;
      font-size: 0.85rem;
      margin: 1.5rem 0 !important;
    }
    
    code:not(pre code) {
      font-size: 0.8em;
      padding: 0.15em 0.4em;
    }
    
    mjx-container[jax="SVG"][display="true"] {
      padding: 1rem;
      margin: 1.5rem 0;
    }
    
    .elegant-button {
      padding: 0.65rem 1.25rem;
      font-size: 0.85rem;
    }
    
    .elegant-button-small {
      padding: 0.45rem 0.85rem;
      font-size: 0.8rem;
    }
  }
  
  @media (max-width: 480px) {
    pre {
      padding: 0.75rem 1rem !important;
      font-size: 0.8rem;
      border-radius: 6px !important;
      margin: 1rem 0 !important;
    }
    
    code:not(pre code) {
      font-size: 0.75em;
      padding: 0.1em 0.3em;
    }
  }
  
  /* Animation system */
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .animate-on-scroll.visible {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Immediate visibility for critical content */
  .post-content .animate-on-scroll,
  .content-wrapper .animate-on-scroll,
  .no-animation {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
  
  /* Staggered animation for multiple elements */
  .animate-on-scroll:nth-child(1) { transition-delay: 0.1s; }
  .animate-on-scroll:nth-child(2) { transition-delay: 0.2s; }
  .animate-on-scroll:nth-child(3) { transition-delay: 0.3s; }
  .animate-on-scroll:nth-child(4) { transition-delay: 0.4s; }
  .animate-on-scroll:nth-child(5) { transition-delay: 0.5s; }
  
  /* Loading animation for async content */
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  
  @keyframes slideInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .fade-in { animation: fadeIn 0.5s ease-out; }
  .slide-in-up { animation: slideInUp 0.6s ease-out; }
  .pulse { animation: pulse 2s infinite; }
  
  /* Print styles */
  @media print {
    body {
      background: white;
      color: black;
      font-size: 12pt;
      line-height: 1.4;
    }
    
    h1, h2, h3, h4, h5, h6 {
      color: black;
      page-break-after: avoid;
    }
    
    pre {
      background: #f5f5f5 !important;
      border: 1px solid #ddd !important;
      padding: 0.5rem !important;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .elegant-button,
    .social-share-btn {
      display: none;
    }
    
    a {
      color: black;
      text-decoration: underline;
    }
    
    a[href]:after {
      content: " (" attr(href) ")";
      font-size: 0.8em;
      color: #666;
    }
  }
</style>

<script>
  // Enhanced scroll-based animations with fallback
  document.addEventListener('DOMContentLoaded', function() {
    // Immediate fallback for critical content
    const criticalElements = document.querySelectorAll('.post-content .animate-on-scroll, .content-wrapper .animate-on-scroll, .no-animation');
    criticalElements.forEach(el => {
      el.classList.add('visible');
    });
    
    // Create intersection observer for animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, {
      threshold: 0.05,
      rootMargin: '50px 0px -10px 0px'
    });
    
    // Observe elements with animation classes (excluding critical content)
    document.querySelectorAll('.animate-on-scroll:not(.post-content .animate-on-scroll):not(.content-wrapper .animate-on-scroll):not(.no-animation)').forEach(el => {
      observer.observe(el);
    });
    
    // Fallback: show all animations after 2 seconds
    setTimeout(() => {
      document.querySelectorAll('.animate-on-scroll:not(.visible)').forEach(el => {
        el.classList.add('visible');
      });
    }, 2000);
    
    // Add language labels to code blocks
    document.querySelectorAll('pre code[class*="language-"]').forEach(block => {
      const pre = block.parentElement;
      const className = block.className;
      const match = className.match(/language-(\w+)/);
      if (match) {
        const language = match[1];
        const languageNames = {
          'js': 'JavaScript',
          'javascript': 'JavaScript',
          'ts': 'TypeScript',
          'typescript': 'TypeScript',
          'py': 'Python',
          'python': 'Python',
          'css': 'CSS',
          'html': 'HTML',
          'json': 'JSON',
          'yaml': 'YAML',
          'yml': 'YAML',
          'markdown': 'Markdown',
          'md': 'Markdown',
          'bash': 'Bash',
          'sh': 'Shell',
          'sql': 'SQL',
          'r': 'R',
          'cpp': 'C++',
          'c': 'C',
          'java': 'Java',
          'go': 'Go',
          'rust': 'Rust',
          'php': 'PHP',
          'ruby': 'Ruby',
          'swift': 'Swift',
          'kotlin': 'Kotlin',
          'scala': 'Scala',
          'tex': 'LaTeX',
          'latex': 'LaTeX'
        };
        pre.setAttribute('data-language', languageNames[language] || language.toUpperCase());
      }
    });
    
    // Enhanced code block copy functionality
    document.querySelectorAll('pre').forEach(pre => {
      // Skip ALL Jupyter notebook areas to avoid interfering with notebook display
      if (pre.closest('.jp-Notebook, .jupyter-notebook, .jp-InputArea, .input_area, .jp-OutputArea, .output_area, .output_subarea, .output_text, .output_stream, .output_stdout, .output_stderr, .output_error, .nbinput, .nboutput, .CodeMirror, .cm-s-jupyter, .highlight-ipynb') ||
          pre.className.match(/jp-|input|output|error|stderr|stdout|jupyter|notebook|nbinput|nboutput|CodeMirror|cm-s-jupyter|highlight-ipynb/) ||
          pre.parentElement.className.match(/jp-|input|output|error|stderr|stdout|jupyter|notebook|nbinput|nboutput|CodeMirror|cm-s-jupyter|highlight-ipynb/) ||
          pre.closest('article[data-mime-type*="jupyter"]')) {
        return;
      }
      
      // Create copy button
      const copyButton = document.createElement('button');
      copyButton.className = 'copy-code-btn';
      copyButton.innerHTML = '📋';
      copyButton.title = 'Copy code';
      copyButton.style.cssText = `
        position: absolute;
        top: 0.75rem;
        right: 0.5rem;
        background: rgba(139, 21, 56, 0.1);
        border: 1px solid rgba(139, 21, 56, 0.2);
        border-radius: 4px;
        padding: 0.25rem 0.5rem;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s ease;
        backdrop-filter: blur(4px);
        z-index: 10;
      `;
      
      copyButton.addEventListener('mouseenter', () => {
        copyButton.style.background = 'rgba(139, 21, 56, 0.2)';
        copyButton.style.transform = 'scale(1.05)';
      });
      
      copyButton.addEventListener('mouseleave', () => {
        copyButton.style.background = 'rgba(139, 21, 56, 0.1)';
        copyButton.style.transform = 'scale(1)';
      });
      
      copyButton.addEventListener('click', async () => {
        const code = pre.querySelector('code');
        const text = code ? code.textContent : pre.textContent;
        
        try {
          await navigator.clipboard.writeText(text);
          copyButton.innerHTML = '✅';
          copyButton.style.background = 'rgba(16, 185, 129, 0.2)';
          if (typeof parseEmojis === 'function') {
            parseEmojis(copyButton);
          }
          setTimeout(() => {
            copyButton.innerHTML = '📋';
            copyButton.style.background = 'rgba(139, 21, 56, 0.1)';
            if (typeof parseEmojis === 'function') {
              parseEmojis(copyButton);
            }
          }, 2000);
        } catch (err) {
          copyButton.innerHTML = '❌';
          if (typeof parseEmojis === 'function') {
            parseEmojis(copyButton);
          }
          setTimeout(() => {
            copyButton.innerHTML = '📋';
            if (typeof parseEmojis === 'function') {
              parseEmojis(copyButton);
            }
          }, 2000);
        }
      });
      
      pre.appendChild(copyButton);
      pre.style.position = 'relative';
      
      // Parse emojis in the copy button
      if (typeof parseEmojis === 'function') {
        parseEmojis(copyButton);
      }
    });
  });
  
  // Re-parse emojis for dynamically added content
  function parseEmojis(element) {
    if (typeof twemoji !== 'undefined') {
      twemoji.parse(element || document.body, {
        folder: 'svg',
        ext: '.svg',
        base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/',
        className: 'emoji',
        attributes: function() {
          return {
            style: 'width: 1.2em !important; height: 1.2em !important; display: inline-block !important; vertical-align: -0.2em !important; margin: 0 0.05em 0 0.1em !important; background: transparent !important; box-shadow: none !important; border: none !important; border-radius: 0 !important; max-width: 1.2em !important; max-height: 1.2em !important;'
          };
        }
      });
    }
  }
  
  // Make parseEmojis available globally
  window.parseEmojis = parseEmojis;
  
  // Initialize emoji parsing when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    // Parse emojis immediately
    parseEmojis();
    
    // Set up a mutation observer to handle dynamically added content
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.addedNodes.length > 0) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === Node.ELEMENT_NODE) {
              parseEmojis(node);
            }
          });
        }
      });
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  });
  
  // Enhanced math rendering callback
  window.addEventListener('load', () => {
    // Re-parse emojis after everything is loaded
    setTimeout(() => {
      parseEmojis();
    }, 200);
    
    // Ensure MathJax renders after animations and content are visible
    if (window.MathJax) {
      setTimeout(() => {
        MathJax.startup.promise.then(() => {
          // Re-render math if needed
          MathJax.typesetPromise();
        });
      }, 500);
    }
  });
  
  // Additional MathJax re-render when content changes
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise().catch((err) => {
          console.log('MathJax rendering error:', err);
        });
      }
    }, 1000);
  });
</script> 